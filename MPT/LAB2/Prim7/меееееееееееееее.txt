#include <ADuC812.inc>
	CSEG AT 0h
	LJMP main
	CSEG AT 0Bh
	LJMP clock
	/*CSEG AT 200Bh
	LJMP Timer0*/
main:
	MOV R1,#0
	MOV R2,#0
	MOV R3,#00000000b
	MOV R4,#00000000b
	CLR TF0
	MOV TH0,#HIGH(55535) 
	MOV TL0,#LOW(55535) 
	MOV TMOD,#00000001b
	MOV IE, #10000010b 
	SETB TR0 
	SJMP $
;...........................................................................	
clock:
    CJNE R2,#1,piu4 
	JMP keyboard
clock1:
	MOV TH0,#HIGH(55535)
	MOV TL0,#LOW(55535)
	INC R2
	MOV R4, P0
	CJNE R4,#00000001b,Hz5
	CJNE R2,#10,stop
	JMP tut
	Hz5:
	CJNE R4,#00000010b,Hz1
	CJNE R2,#20,stop
	JMP tut
	Hz1:
	CJNE R2,#10,stop
	tut:
	MOV A,R1
	MOV P3,A 
	JMP napravlenie
	vlevo:
	RL A
	MOV R1,A
	MOV R2,#0
	RETI
	napravlenie:
	CJNE R3,#11111111b,vlevo
	RR A
	MOV R1,A
	MOV R2,#0
	RETI
stop:
	RETI
;...........................................................................	
keyboard:
	MOV A,#11111110b
	MOV P2,A
	MOV A,P2
	CJNE A,#11111110b,piu1
	
	MOV A,#11111101b
	MOV P2,A
	MOV A,P2
	CJNE A,#11111101b,piu4
	
	MOV A,#11111011b
	MOV P2,A
	MOV A,P2
	CJNE A,#11111011b,piu7
	
	MOV A,#11110111b
	MOV P2,A
	MOV A,P2
	CJNE A,#11110111b,piu0
	
piu1:
	CJNE A,#11101110b,piu2
	MOV R1,#00000001b
	JMP clock1
piu2:
	CJNE A,#11011110b,piu3
	MOV R1,#00000011b
	JMP clock1
	
piu3:
	CJNE A,#10111110b,clock1
	MOV R1,#00000111b
	JMP clock1
	
piu4:
	CJNE A,#11101101b,piu5
	MOV R1,#00001111b	
	JMP clock1
	
piu5:
	CJNE A,#11011101b,piu6
	MOV R1,#00011111b
	JMP clock1

piu6:
	CJNE A,#10111101b,clock1
	MOV R1,#00111111b
	JMP clock1
	
piu7:
	CJNE A,#11101011b,piu8
	MOV R1,#01111111b
	JMP clock1

piu8:
	CJNE A,#11011011b,piu9
	MOV R1,#11111111b
	JMP clock1
	
piu9:
	CJNE A,#11011011b,clock1_end
	MOV R1,#11111111b
	clock1_end:
	JMP clock1
	
piu0:
	CJNE A,#11010111b,zvezda
	MOV R1,#0b
	JMP clock1

zvezda:
	CJNE A,#11100111b,zvezda_end
	MOV A,R3
	CPL A
	MOV R3,A
	CLR A
	zvezda_end:
	JMP clock1	

END
;...........................................................................